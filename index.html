<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>will + jolene</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            height: 100%;
            height: 100dvh;
            overflow-x: hidden;
            overflow-y: hidden;
            position: fixed;
            width: 100%;
            width: 100dvw;
            background: linear-gradient(135deg, #0a1a0e 0%, #0d2d14 40%, #0a1f0d 50%, #1a2e0f 100%);
        }

        /* Animated gradient overlay for depth */
        .bg-glow {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse 60% 50% at 50% 20%, rgba(80, 200, 120, 0.12) 0%, transparent 50%),
                        radial-gradient(ellipse 40% 40% at 80% 80%, rgba(60, 180, 100, 0.08) 0%, transparent 45%);
            pointer-events: none;
            z-index: 0;
            animation: bgFloat 20s ease-in-out infinite;
        }
        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 1; }
            50% { transform: translate(-2%, -1%) scale(1.05); opacity: 0.9; }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: transparent;
            min-height: 100%;
            min-height: 100vh;
            min-height: 100dvh;
            height: 100%;
            height: 100dvh;
            width: 100%;
            width: 100dvw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            overflow-x: hidden;
            overflow-y: auto;
            margin: 0;
        }

        #starsCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            width: 100vw;
            width: 100dvw;
            height: 100%;
            height: 100vh;
            height: 100dvh;
            z-index: 0;
            pointer-events: none;
            display: block;
        }

        .container > * {
            opacity: 0;
            transform: translateY(20px);
        }

        .container {
            position: relative;
            z-index: 1;
            text-align: center;
            max-width: 600px;
            width: 100%;
            background: transparent;
        }

        h1 {
            font-size: 64px;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-shadow: 0 0 30px rgba(80, 180, 100, 0.35);
            animation: titleGlow 4s ease-in-out infinite;
        }
        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 30px rgba(80, 180, 100, 0.35); }
            50% { text-shadow: 0 0 45px rgba(120, 220, 140, 0.5); }
        }

        .countdown-text {
            font-size: 14px;
            color: rgba(200, 255, 220, 0.85);
            margin-bottom: 40px;
            letter-spacing: 1px;
        }

        .countdown-timer {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
            letter-spacing: 1px;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 40px auto 0;
            max-width: 500px;
            width: 100%;
        }

        .option-button {
            background: rgba(15, 60, 25, 0.5);
            border: 2px solid rgba(120, 200, 140, 0.35);
            border-radius: 16px;
            padding: 20px;
            font-size: 32px;
            color: rgba(255, 255, 255, 0.95);
            cursor: pointer;
            transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease, background 0.3s ease, border-color 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(20, 80, 35, 0.4);
            min-height: 70px;
            aspect-ratio: 1;
            backdrop-filter: blur(10px);
        }

        .option-button:hover {
            background: rgba(35, 100, 50, 0.55);
            border-color: rgba(150, 220, 170, 0.55);
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 12px 28px rgba(80, 180, 100, 0.35);
        }

        .option-button:active {
            transform: translateY(-2px) scale(0.98);
            transition-duration: 0.1s;
        }

        .option-button i {
            font-size: 32px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 20, 10, 0);
            backdrop-filter: blur(0px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease, backdrop-filter 0.35s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
            background: rgba(5, 20, 10, 0.7);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: rgba(15, 45, 22, 0.96);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
            position: relative;
            border: 1px solid rgba(100, 180, 120, 0.4);
            backdrop-filter: blur(12px);
            transform: scale(0.92);
            opacity: 0;
            transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
        }

        .modal.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 32px;
            color: rgba(200, 255, 220, 0.75);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-button:hover {
            background: rgba(80, 180, 100, 0.25);
            color: #fff;
        }

        .modal-title {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            text-align: center;
        }

        .weather-content {
            font-size: 18px;
            color: rgba(230, 255, 240, 0.88);
            line-height: 1.8;
        }

        .weather-location {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(25, 80, 35, 0.35);
            border-radius: 8px;
            border-left: 4px solid rgba(120, 200, 140, 0.5);
        }

        .weather-location h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.95);
        }

        .weather-info {
            font-size: 16px;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .photo-item {
            aspect-ratio: 4 / 3;
            overflow: hidden;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            border: 2px solid rgba(100, 180, 120, 0.2);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .photo-item:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
            border-color: rgba(120, 200, 140, 0.5);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.4s ease;
        }

        .photo-item:hover img {
            transform: scale(1.06);
        }

        .notes-content {
            font-size: 18px;
            color: rgba(230, 255, 240, 0.88);
            line-height: 1.8;
        }

        .note-item {
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(25, 80, 35, 0.35);
            border-radius: 8px;
            border-left: 4px solid rgba(120, 200, 140, 0.5);
        }

        .loading {
            text-align: center;
            color: rgba(200, 255, 220, 0.85);
            font-size: 18px;
            padding: 20px;
        }

        .distance-content {
            font-size: 18px;
            color: rgba(230, 255, 240, 0.88);
            line-height: 1.8;
        }

        .distance-info {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(25, 80, 35, 0.35);
            border-radius: 8px;
            border-left: 4px solid rgba(120, 200, 140, 0.5);
        }

        .distance-info h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.95);
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
            border: 2px solid rgba(100, 180, 120, 0.35);
        }

        .map-container.leaflet-container {
            font-family: inherit;
        }

        .map-container .leaflet-popup-content-wrapper {
            background: rgba(15, 45, 22, 0.95);
            border: 1px solid rgba(100, 180, 120, 0.4);
            border-radius: 8px;
            color: rgba(230, 255, 240, 0.9);
        }

        .map-container .leaflet-popup-tip {
            background: rgba(15, 45, 22, 0.95);
        }

        .quote-block {
            margin-top: 28px;
            padding: 16px 20px;
            background: rgba(15, 60, 25, 0.4);
            border-radius: 12px;
            border-left: 3px solid rgba(120, 200, 140, 0.6);
            text-align: left;
        }

        .quote-block .quote-text {
            font-size: 15px;
            color: rgba(230, 255, 240, 0.9);
            line-height: 1.6;
            font-style: italic;
        }

        .quote-block .quote-author {
            font-size: 12px;
            color: rgba(200, 255, 220, 0.65);
            margin-top: 8px;
        }

        .moon-phase {
            font-size: 13px;
            color: rgba(200, 255, 220, 0.75);
            margin-top: 12px;
            letter-spacing: 0.5px;
        }

        .music-content {
            font-size: 18px;
            color: rgba(230, 255, 240, 0.88);
        }

        .playlist-container {
            margin-bottom: 30px;
            border-radius: 12px;
            border: 2px solid rgba(100, 180, 120, 0.35);
            overflow: hidden;
            background: #0a0d0b;
        }

        .playlist-container:last-child {
            margin-bottom: 0;
        }

        .playlist-container iframe {
            width: 100%;
            display: block;
            border: none;
        }

        .timeline-content {
            font-size: 18px;
            color: rgba(230, 255, 240, 0.88);
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            position: relative;
            padding-left: 40px;
            padding-bottom: 40px;
            border-left: 3px solid rgba(120, 200, 140, 0.45);
        }

        .timeline-item:last-child {
            border-left: none;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(120, 200, 140, 0.7);
            border: 3px solid #0d2d14;
            box-shadow: 0 0 0 2px rgba(120, 200, 140, 0.4), 0 0 10px rgba(80, 180, 100, 0.3);
        }

        .timeline-date {
            font-size: 20px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 8px;
        }

        .timeline-event {
            font-size: 16px;
            color: rgba(230, 255, 240, 0.88);
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            html, body {
                height: 100dvh !important;
                min-height: 100dvh !important;
                position: fixed;
                width: 100%;
                overflow: hidden;
            }

            body {
                padding: 0;
            }

            #starsCanvas {
                width: 100vw !important;
                width: 100dvw !important;
                height: 100vh !important;
                height: 100dvh !important;
            }

            h1 {
                font-size: 48px;
                margin-bottom: 40px;
            }

            .options {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                max-width: 100%;
            }

            .option-button {
                padding: 15px;
                font-size: 24px;
                min-height: 60px;
            }

            .modal-content {
                padding: 30px 20px;
            }

            .photos-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <canvas id="starsCanvas"></canvas>
    <div class="bg-glow" aria-hidden="true"></div>
    <div class="container">
        <h1>will + jolene</h1>
        <div class="countdown-text">
            time till next visit: <span id="countdownTimer" class="countdown-timer"></span>
        </div>
        <div class="options">
            <button class="option-button" onclick="showWeather()" title="weather"><i class="fas fa-cloud"></i></button>
            <button class="option-button" onclick="showPhotos()" title="photos"><i class="fas fa-camera"></i></button>
            <button class="option-button" onclick="showNotes()" title="notes"><i class="fas fa-sticky-note"></i></button>
            <button class="option-button" onclick="showDistance()" title="distance"><i class="fas fa-map-marker-alt"></i></button>
            <button class="option-button" onclick="showMusic()" title="music"><i class="fas fa-music"></i></button>
            <button class="option-button" onclick="showTimeline()" title="timeline"><i class="fas fa-calendar-alt"></i></button>
        </div>
        <div id="quoteBlock" class="quote-block" style="display: none;">
            <p class="quote-text" id="quoteText"></p>
            <p class="quote-author" id="quoteAuthor"></p>
        </div>
        <p class="moon-phase" id="moonPhase"></p>
    </div>

    <!-- Weather Modal -->
    <div id="weatherModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('weatherModal')">&times;</button>
            <h2 class="modal-title">weather</h2>
            <div id="weatherContent" class="weather-content">
                <div class="loading">loading weather...</div>
            </div>
        </div>
    </div>

    <!-- Photos Modal -->
    <div id="photosModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('photosModal')">&times;</button>
            <h2 class="modal-title">photos</h2>
            <div id="photosContent" class="photos-grid"></div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('notesModal')">&times;</button>
            <h2 class="modal-title">notes</h2>
            <div id="notesContent" class="notes-content">
                <div class="note-item">
                    <p style="margin-top: 10px; color: rgba(200, 255, 220, 0.65); font-size: 14px;">2/20/2026</p>
                    <p style="margin-top: 15px;">i love you so much, gonna miss u for this next month</p>
                </div>
                <div class="note-item">
                    <p style="margin-top: 10px; color: rgba(200, 255, 220, 0.65); font-size: 14px;">2/3/2026</p>
                    <p style="margin-top: 15px;">so proud of u; so unbelivably smart</p>
                </div>
                <div class="note-item">
                    <p style="margin-top: 10px; color: rgba(200, 255, 220, 0.65); font-size: 14px;">2/6/2026</p>
                    <p style="margin-top: 15px;">thank u for being with me at my best and my worst. always grateful for u</p>
                </div>
                <div class="note-item">
                    <p style="margin-top: 10px; color: rgba(200, 255, 220, 0.65); font-size: 14px;">1/28/2026</p>
                    <p style="margin-top: 15px;">you looked gorgeous on the phone, i am so lucky to have u</p>
                </div>
                <div class="note-item">
                    <p style="margin-top: 10px; color: rgba(200, 255, 220, 0.65); font-size: 14px;">1/21/2026</p>
                    <p style="margin-top: 15px;">love ya! keeping this so i can write notes here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Distance Modal -->
    <div id="distanceModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('distanceModal')">&times;</button>
            <h2 class="modal-title">distance</h2>
            <div id="distanceContent" class="distance-content">
                <div class="loading">loading distance...</div>
            </div>
        </div>
    </div>

    <!-- Music Modal -->
    <div id="musicModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('musicModal')">&times;</button>
            <h2 class="modal-title">music</h2>
            <div id="musicContent" class="music-content">
                <div class="playlist-container">
                    <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/5jE1hOdhcEA9wl7LK8WZDV?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                </div>
                <div class="playlist-container">
                    <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/5JhcSZVG1LiAiEUCRvHJPR?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                </div>
                <div class="playlist-container">
                    <iframe data-testid="embed-iframe" style="border-radius:12px" src="https://open.spotify.com/embed/playlist/7G5VgdvUREXtiLFPXSi3p3?utm_source=generator&theme=0" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Timeline Modal -->
    <div id="timelineModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal('timelineModal')">&times;</button>
            <h2 class="modal-title">timeline</h2>
            <div id="timelineContent" class="timeline-content">
                <div class="timeline-item">
                    <div class="timeline-date">2021</div>
                    <div class="timeline-event">will + jolene met</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">jan 17 2026</div>
                    <div class="timeline-event">official</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">may 2026</div>
                    <div class="timeline-event">will graduation</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">may 2028</div>
                    <div class="timeline-event">jolene graduation</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">2028-onward</div>
                    <div class="timeline-event">tbd idk maybe marry me plz ty</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Starry night canvas animation
        const canvas = document.getElementById('starsCanvas');
        const ctx = canvas.getContext('2d');
        
        // Create stars array
        const stars = [];
        const numStars = 200;
        
        function resizeCanvas() {
            const oldWidth = canvas.width || window.innerWidth;
            const oldHeight = canvas.height || window.innerHeight;
            
            // Set canvas to full viewport size - use the larger of innerHeight or document height for mobile
            const viewportWidth = Math.max(window.innerWidth, document.documentElement.clientWidth, window.screen.width);
            const viewportHeight = Math.max(window.innerHeight, document.documentElement.clientHeight, window.screen.height);
            
            canvas.width = viewportWidth;
            canvas.height = viewportHeight;
            
            // Scale existing stars to new canvas size if they exist
            if (stars.length > 0 && oldWidth > 0 && oldHeight > 0 && (oldWidth !== canvas.width || oldHeight !== canvas.height)) {
                const scaleX = canvas.width / oldWidth;
                const scaleY = canvas.height / oldHeight;
                stars.forEach(star => {
                    star.x *= scaleX;
                    star.y *= scaleY;
                    // Ensure stars stay within bounds
                    if (star.x > canvas.width) star.x = canvas.width;
                    if (star.y > canvas.height) star.y = canvas.height;
                });
            }
        }
        
        function createStars() {
            stars.length = 0; // Clear existing stars
            for (let i = 0; i < numStars; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 1.5 + 0.5,
                    opacity: Math.random(),
                    twinkleSpeed: Math.random() * 0.02 + 0.01
                });
            }
        }
        
        // Initialize canvas and stars - wait for page load to ensure proper sizing
        function initCanvas() {
            resizeCanvas();
            // If canvas is still 0x0, try again after a short delay (mobile fix)
            if (canvas.width === 0 || canvas.height === 0) {
                setTimeout(() => {
                    resizeCanvas();
                    createStars();
                }, 100);
            } else {
                createStars();
            }
        }
        
        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initCanvas);
        } else {
            initCanvas();
        }
        
        // Also initialize on window load (for mobile)
        window.addEventListener('load', () => {
            setTimeout(() => {
                resizeCanvas();
                if (stars.length === 0) {
                    createStars();
                }
            }, 200);
        });
        
        // Handle window resize with debounce
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                resizeCanvas();
                // If canvas grew significantly, add more stars to fill the space
                if (canvas.width * canvas.height > (window.innerWidth * window.innerHeight * 1.2)) {
                    const additionalStars = Math.floor((canvas.width * canvas.height) / (window.innerWidth * window.innerHeight) * numStars) - numStars;
                    for (let i = 0; i < additionalStars && stars.length < 400; i++) {
                        stars.push({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            radius: Math.random() * 1.5 + 0.5,
                            opacity: Math.random(),
                            twinkleSpeed: Math.random() * 0.02 + 0.01
                        });
                    }
                }
            }, 150);
        });
        
        function animateStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            stars.forEach(star => {
                // Twinkling effect
                star.opacity += star.twinkleSpeed;
                if (star.opacity > 1 || star.opacity < 0.3) {
                    star.twinkleSpeed = -star.twinkleSpeed;
                }
                
                // Draw star
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(220, 255, 200, ${star.opacity})`;
                ctx.fill();
                
                // Add glow effect for some stars (St. Patrick's green/gold)
                if (star.radius > 1) {
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = 'rgba(180, 255, 120, 0.6)';
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            });
            
            requestAnimationFrame(animateStars);
        }
        
        animateStars();

        // GSAP: staggered entrance animation
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.container');
            if (container && typeof gsap !== 'undefined') {
                const kids = container.querySelectorAll(':scope > *');
                gsap.to(kids, {
                    opacity: 1,
                    y: 0,
                    duration: 0.8,
                    stagger: 0.12,
                    ease: 'power3.out',
                    overwrite: 'auto'
                });
            }
        });

        // Countdown timer to March 12, 2026
        function updateCountdown() {
            const targetDate = new Date('2026-03-12T00:00:00-05:00'); // March 12, 2026 EST
            const now = new Date();
            const difference = targetDate - now;

            if (difference <= 0) {
                document.getElementById('countdownTimer').textContent = '0 days, 0 hours, 0 minutes, 0 seconds';
                return;
            }

            const days = Math.floor(difference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((difference % (1000 * 60)) / 1000);

            document.getElementById('countdownTimer').textContent = 
                `${days} days, ${hours} hours, ${minutes} minutes, ${seconds} seconds`;
        }

        // Update countdown immediately and then every second
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // Love quote from quotable.io (free, no API key)
        fetch('https://api.quotable.io/random?tags=love')
            .then(r => r.json())
            .then(data => {
                const block = document.getElementById('quoteBlock');
                const text = document.getElementById('quoteText');
                const author = document.getElementById('quoteAuthor');
                if (block && text && author) {
                    text.textContent = '"' + data.content + '"';
                    author.textContent = 'â€” ' + (data.author || 'Unknown');
                    block.style.display = 'block';
                    if (typeof gsap !== 'undefined') {
                        gsap.fromTo(block, { opacity: 0, y: 8 }, { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' });
                    }
                }
            })
            .catch(() => {});

        // Moon phase (client-side, no API)
        function getMoonPhase() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            let c = 0, e = 0, jd = 0, b = 0;
            if (month < 3) { c = year - 1; e = month + 12; } else { c = year; e = month; }
            jd = Math.floor(365.25 * c) + Math.floor(30.6001 * (e + 1)) + day - 694039.09;
            jd /= 29.5305882;
            b = parseInt(jd);
            jd -= b;
            b = Math.round(jd * 8);
            if (b >= 8) b = 0;
            const phases = ['new moon', 'waxing crescent', 'first quarter', 'waxing gibbous', 'full moon', 'waning gibbous', 'last quarter', 'waning crescent'];
            const emoji = ['ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜'];
            return emoji[b] + ' ' + phases[b];
        }
        const moonEl = document.getElementById('moonPhase');
        if (moonEl) moonEl.textContent = "tonight's moon: " + getMoonPhase();

        const images = [
            'images/IMG_0972.jpg',
            'images/IMG_0993.jpg',
            'images/IMG_6354.jpg',
            'images/IMG_6732.jpg',
            'images/IMG_6780.jpg',
            'images/IMG_6786.jpg',
            'images/IMG_6830.jpg',
            'images/IMG_6831.jpg',
            'images/IMG_6832.jpg',
            'images/IMG_7253.jpg',
            'images/IMG_7653.jpg',
            'images/IMG_9225.jpg',
            'images/IMG_9627.jpg'
        ];

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        const getWeatherDescription = (code) => {
            const weatherCodes = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                53: 'Moderate drizzle',
                55: 'Dense drizzle',
                61: 'Slight rain',
                63: 'Moderate rain',
                65: 'Heavy rain',
                71: 'Slight snow',
                73: 'Moderate snow',
                75: 'Heavy snow',
                80: 'Slight rain showers',
                81: 'Moderate rain showers',
                82: 'Violent rain showers',
                85: 'Slight snow showers',
                86: 'Heavy snow showers',
                95: 'Thunderstorm',
                96: 'Thunderstorm with slight hail',
                99: 'Thunderstorm with heavy hail'
            };
            return weatherCodes[code] || 'Unknown';
        };

        async function showWeather() {
            showModal('weatherModal');
            const content = document.getElementById('weatherContent');
            content.innerHTML = '<div class="loading">loading weather...</div>';

            try {
                // Harrisonburg, VA
                const harrisonburgUrl = 'https://api.open-meteo.com/v1/forecast?latitude=38.4496&longitude=-78.8689&current=temperature_2m,weather_code,wind_speed_10m&temperature_unit=fahrenheit&wind_speed_unit=mph';
                // Penn State (State College, PA)
                const pennStateUrl = 'https://api.open-meteo.com/v1/forecast?latitude=40.7934&longitude=-77.8600&current=temperature_2m,weather_code,wind_speed_10m&temperature_unit=fahrenheit&wind_speed_unit=mph';

                const [hburgRes, psRes] = await Promise.all([
                    fetch(harrisonburgUrl),
                    fetch(pennStateUrl)
                ]);

                const hburgData = await hburgRes.json();
                const psData = await psRes.json();

                const hburg = hburgData.current;
                const ps = psData.current;

                content.innerHTML = `
                    <div class="weather-location">
                        <h3>harrisonburg, va (will)</h3>
                        <div class="weather-info">
                            <p><strong>temperature:</strong> ${hburg.temperature_2m}Â°f</p>
                            <p><strong>conditions:</strong> ${getWeatherDescription(hburg.weather_code)}</p>
                            <p><strong>wind speed:</strong> ${hburg.wind_speed_10m} mph</p>
                        </div>
                    </div>
                    <div class="weather-location">
                        <h3>penn state (state college, pa) (jolene)</h3>
                        <div class="weather-info">
                            <p><strong>temperature:</strong> ${ps.temperature_2m}Â°f</p>
                            <p><strong>conditions:</strong> ${getWeatherDescription(ps.weather_code)}</p>
                            <p><strong>wind speed:</strong> ${ps.wind_speed_10m} mph</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="loading">error loading weather: ${error.message}</div>`;
            }
        }

        function showPhotos() {
            showModal('photosModal');
            const content = document.getElementById('photosContent');
            content.innerHTML = '';

            images.forEach(imagePath => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                const img = document.createElement('img');
                img.src = imagePath;
                img.alt = 'photo';
                img.loading = 'lazy';
                photoItem.appendChild(img);
                content.appendChild(photoItem);
            });

            if (typeof gsap !== 'undefined') {
                const items = content.querySelectorAll('.photo-item');
                gsap.fromTo(items, { opacity: 0, y: 14 }, { opacity: 1, y: 0, duration: 0.5, stagger: 0.05, delay: 0.2, ease: 'power2.out' });
            }
        }

        function showNotes() {
            showModal('notesModal');
        }

        // Calculate distance between two coordinates using Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        const MAPTILER_KEY = 'ZfLieNsvBMHToyb5OgLr';
        let distanceMapInstance = null;

        function showDistance() {
            if (distanceMapInstance) {
                distanceMapInstance.remove();
                distanceMapInstance = null;
            }
            showModal('distanceModal');
            const content = document.getElementById('distanceContent');
            const jmuLat = 38.4344;
            const jmuLon = -78.8699;
            const pennStateLat = 40.7982;
            const pennStateLon = -77.8599;
            const distance = calculateDistance(jmuLat, jmuLon, pennStateLat, pennStateLon);
            const distanceKm = distance * 1.60934;

            content.innerHTML = `
                <div class="distance-info">
                    <h3>james madison university â†’ penn state university</h3>
                    <div class="weather-info">
                        <p><strong>distance:</strong> ${distance.toFixed(1)} miles (${distanceKm.toFixed(1)} km)</p>
                        <p><strong>driving time:</strong> approximately ${Math.round(distance / 60)} hours</p>
                    </div>
                </div>
                <div id="distanceMap" class="map-container"></div>
                <p style="margin-top: 10px; text-align: center; font-size: 14px; color: rgba(200, 255, 220, 0.65);">
                    <a href="https://api.maptiler.com/maps/streets/?key=${MAPTILER_KEY}#8/${(jmuLat + pennStateLat) / 2}/${(jmuLon + pennStateLon) / 2}" target="_blank" style="color: rgba(220, 255, 200, 0.85);">view in MapTiler</a>
                </p>
            `;

            setTimeout(function() {
                const mapEl = document.getElementById('distanceMap');
                if (!mapEl) return;
                const map = L.map('distanceMap').setView([(jmuLat + pennStateLat) / 2, (jmuLon + pennStateLon) / 2], 6);
                L.tileLayer('https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=' + MAPTILER_KEY, {
                    attribution: '&copy; <a href="https://www.maptiler.com/copyright/">MapTiler</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                    tileSize: 512,
                    zoomOffset: -1
                }).addTo(map);
                L.marker([jmuLat, jmuLon]).addTo(map).bindPopup('<b>James Madison University</b><br>Harrisonburg, VA (will)');
                L.marker([pennStateLat, pennStateLon]).addTo(map).bindPopup('<b>Penn State University</b><br>State College, PA (jolene)');
                map.fitBounds([[jmuLat, jmuLon], [pennStateLat, pennStateLon]], { padding: [40, 40] });
                distanceMapInstance = map;
            }, 100);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const distanceModal = document.getElementById('distanceModal');
            if (distanceModal) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(m) {
                        if (m.target.classList.contains('active')) return;
                        if (distanceMapInstance) {
                            distanceMapInstance.remove();
                            distanceMapInstance = null;
                        }
                    });
                });
                observer.observe(distanceModal, { attributes: true, attributeFilter: ['class'] });
            }
        });

        function showMusic() {
            showModal('musicModal');
        }

        function showTimeline() {
            showModal('timelineModal');
        }

    </script>
</body>
</html>
